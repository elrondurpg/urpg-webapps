<div class="accordion" [id]="getTitle() + 'Accordion'">
    <div class="card-header" id="headingOne">
        <div class="row">
            <div class="col-sm-4">
                <button class="btn btn-link" type="button" data-toggle="collapse" [attr.data-target]="'#' + getTitle() + 'Collapse'" aria-expanded="true" [attr.aria-controls]="getTitle() + 'Collapse'">
                    {{ title }}
                </button>
            </div>
            <div class="col-sm-4">
                <input 
                    *ngIf="mappedItems.getNumFilterableKeys() == 1" 
                    type="text" 
                    class="form-control" 
                    [(ngModel)]="filters[mappedItems.getFirstFilterableKey().deltaSelector]" 
                    [placeholder]="'Filter ' + mappedItems.getFirstFilterableKey().title">
            </div>
            <div class="col-sm-2">
                <!--button *ngIf="importable" type="button" class="btn btn-primary btn-block"  data-toggle="modal" [attr.data-target]="'#bulkImport' + getTitle() + 'Modal'">
                    Bulk Import
                </button-->
            </div>
            <div class="col-sm-2">
                <button type="button" class="btn btn-primary btn-block"  data-toggle="modal" [attr.data-target]="'#new' + getTitle() + 'Modal'">
                    + New
                </button>
            </div>
        </div>
        <div class="row" *ngIf="mappedItems.getNumFilterableKeys() > 1" [id]="getTitle() + 'Collapse'" class="collapse" [attr.data-parent]="'#' + getTitle() + 'Accordion'">
            <div class="col">
                <div class="row p-2" *ngFor="let filterableKey of mappedItems.getFilterableKeys()">
                    <div class="col">
                        <input 
                            type="text" 
                            class="form-control" 
                            [(ngModel)]="filters[filterableKey.deltaSelector]" 
                            [placeholder]="'Filter ' + filterableKey.label">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div [id]="getTitle() + 'Collapse'" class="collapse" aria-labelledby="headingOne" [attr.data-parent]="'#' + getTitle() + 'Accordion'">

        <div class="container">
            <div class="row bg-dark text-light p-2" *ngIf="this.mappedItems !== undefined && this.mappedItems.fieldDefinitions !== undefined">
                <div class="col">
                    <h5>{{ headerColumn1 }}</h5>
                </div>
                <div class="col" *ngIf="editType == 'update'">
                    <h5>{{ headerColumn2 }}</h5>
                </div>
                <div class="col">
                    <h5>{{ headerColumn3 }}</h5>
                </div>
            </div>
            <div class="row p-2" *ngIf="this.mappedItems.isEmpty()">
                <p>There doesn't seem to be anything here! Click the New+ button to begin.</p>
            </div>


            <ng-container *ngFor="let delta of this.mappedItems.getFilteredDeltas(filters)">
                <div class="row p-2 border-bottom">
                    <div class="col">
                        <div class="row" *ngFor="let definedKey of mappedItems.keyDefinitions">
                            <div class="col" *ngIf="definedKey.label != undefined">
                                <label class="col-form-label" [ngClass]="delta['delete'] == true ? 'strikethrough' : ''">
                                    <h6>{{ definedKey.label }}</h6>
                                </label>
                            </div>
                            <div class="col">
                                <input 
                                    type="text" readonly 
                                    class="form-control-plaintext" 
                                    value="{{ delta[definedKey.deltaSelector] }}"
                                    [ngClass]="delta['delete'] == true ? 'strikethrough' : ''">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <button type="submit" class="btn btn-primary btn-block" (click)="toggleDelete(delta)">
                                    {{ delta["delete"] ? 'Restore' : 'Delete' }}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="row" *ngFor="let definedField of mappedItems.fieldDefinitions">
                            <div class="col">
                                <label 
                                    class="col-form-label" 
                                    [ngClass]="delta['delete'] == true ? 'strikethrough' : ''"
                                    *ngIf="mappedItems.getPrototype(delta) !== undefined">
                                    <h6>{{ definedField.label }}</h6>
                                </label>
                            </div>
                            <div class="col">
                                <input 
                                    *ngIf="mappedItems.getPrototype(delta) !== undefined"
                                    type="text" readonly 
                                    class="form-control-plaintext" 
                                    value="{{ mappedItems.getPrototype(delta)[definedField.name] }}"
                                    [ngClass]="delta['delete'] == true ? 'strikethrough' : ''">
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="row" *ngFor="let definedField of mappedItems.fieldDefinitions">
                            <div class="col">
                                <label class="col-form-label" [ngClass]="delta['delete'] == true ? 'strikethrough' : ''">
                                    <h6>{{ definedField.label }}</h6>
                                </label>
                            </div>
                            <div class="col">
                                <input 
                                    *ngIf="definedField.type == 'text'"
                                    type="text" 
                                    class="form-control" 
                                    #validator="ngModel"
                                    [(ngModel)]="delta[definedField.name]"
                                    [ngClass]="delta['delete'] == true ? 'strikethrough' : ''">
                                <resources-accordion-attribute-boolean 
                                    *ngIf="definedField.type == 'boolean'"
                                    [field]="definedField"
                                    [isNew]="mappedItems.getPrototype(delta) === undefined"
                                    [(ngModel)]="delta[definedField.name]"
                                    [ngClass]="delta['delete'] == true ? 'strikethrough' : ''"
                                    ></resources-accordion-attribute-boolean>
                                <resources-accordion-attribute-select
                                    *ngIf="definedField.type == 'select'"
                                    [isNew]="mappedItems.getPrototype(delta) === undefined"
                                    [field]="definedField"
                                    [(ngModel)]="delta[definedField.name]"
                                    [ngClass]="delta['delete'] == true ? 'strikethrough' : ''"
                                    [items]="definedField.selectList"
                                ></resources-accordion-attribute-select>
                                <resources-accordion-attribute-number
                                    *ngIf="definedField.type == 'number'"
                                    [isNew]="mappedItems.getPrototype(delta) === undefined"
                                    [field]="definedField"
                                    [(ngModel)]="delta[definedField.name]"
                                    [ngClass]="delta['delete'] == true ? 'strikethrough' : ''"
                                    [minvalue]="definedField.min"
                                    [maxvalue]="definedField.max"
                                    [step]="definedField.step"></resources-accordion-attribute-number>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>
</div>

<resources-new-item-modal
    [title]="title"
    [mappedItems]="mappedItems"
    (create)="onNewItemCreate($event)"></resources-new-item-modal>